<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JOYEUX NO√ãL KANTO ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;900&family=Kosugi+Maru&family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-timeline: #fdf0f6;
            --ink: #1a1a1a;
            --xmas-red: #ff4757;
            --xmas-green: #2ed573;
            --xmas-gold: #ffa502;
            --night-bg: #0f172a;
        }

        body {
            background-color: var(--bg-timeline);
            font-family: 'Kosugi Maru', sans-serif;
            overflow: hidden;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- STYLES TIMELINE (Intro) --- */
        .timeline-view {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10;
            background-image: radial-gradient(#ffdbe9 20%, transparent 20%);
            background-size: 20px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 3rem;
            transition: opacity 1s;
        }

        .header-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 3rem;
            color: var(--xmas-red);
            text-shadow: 2px 2px 0px white;
            transform: rotate(-3deg);
            margin-bottom: 2rem;
        }

        .final-card {
            background: white;
            border: 4px solid var(--xmas-gold);
            border-radius: 20px;
            padding: 2rem;
            width: 85%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 0px rgba(0,0,0,0.1);
            position: relative;
            cursor: pointer;
            animation: pulse-gold 2s infinite;
        }

        .card-badge {
            background: var(--xmas-red);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-weight: bold;
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            border: 2px solid white;
        }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(255, 165, 2, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(255, 165, 2, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 165, 2, 0); }
        }

        /* --- SC√àNE DE NO√ãL --- */
        .christmas-scene {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, #090910 0%, #1a1f3c 100%);
            z-index: 20;
            opacity: 0;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-y: auto; /* Allow scroll at the end */
        }
        
        .christmas-scene.active {
            opacity: 1;
            pointer-events: all;
        }

        #snow-canvas {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* --- TEXTE HISTOIRE --- */
        .story-text {
            font-family: 'Mountains of Christmas', cursive;
            color: white;
            font-size: 2rem;
            text-align: center;
            max-width: 80%;
            text-shadow: 0 0 10px rgba(255,255,255,0.8);
            position: absolute;
            top: 20%;
            opacity: 0;
            transform: translateY(20px);
            z-index: 30;
        }

        /* --- LA BO√éTE CADEAU --- */
        .gift-wrapper {
            position: relative;
            width: 200px;
            height: 200px;
            margin-top: 50px;
            z-index: 40;
            cursor: pointer;
            opacity: 0;
            transform: scale(0);
        }

        .gift-box {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 80%;
            background: #ff4757;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .gift-box::before {
            content: '';
            position: absolute;
            left: 50%; top: 0; bottom: 0;
            width: 30px;
            background: white;
            transform: translateX(-50%);
        }
        
        .gift-lid {
            position: absolute;
            top: 0; left: -10%;
            width: 120%; height: 25%;
            background: #ff6b81;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2;
            transition: transform 0.2s;
        }
        .gift-lid::before {
            content: '';
            position: absolute;
            left: 50%; top: 0; bottom: 0;
            width: 30px;
            background: white;
            transform: translateX(-50%);
        }
        .gift-bow {
            position: absolute;
            top: -40px; left: 50%;
            transform: translateX(-50%);
            font-size: 4rem;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3));
            z-index: 3;
        }

        .tap-hint {
            position: absolute;
            bottom: -60px;
            width: 140%;
            left: -20%;
            text-align: center;
            color: #ffd700;
            font-family: 'Fredoka', sans-serif;
            font-size: 0.9rem;
            animation: bounce 1s infinite;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.3);
            padding: 5px;
            border-radius: 10px;
            line-height: 1.2;
        }

        /* --- LES OBJETS (LOOT) --- */
        .loot-item {
            position: absolute;
            top: 50%; left: 50%;
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 1rem;
            transform: translate(-50%, -50%) scale(0);
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.4);
            z-index: 100;
            border: 4px solid var(--ink);
            display: none;
        }

        .loot-image {
            width: 100%;
            height: 180px;
            background: #f0f0f0;
            border-radius: 12px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            border: 2px dashed var(--ink);
            position: relative;
            overflow: hidden;
        }
        
        .loot-bg-pattern {
            position: absolute;
            width: 100%; height: 100%;
            opacity: 0.1;
            background-image: repeating-linear-gradient(45deg, #000 0, #000 2px, transparent 2px, transparent 10px);
        }

        .loot-title {
            font-family: 'Fredoka', sans-serif;
            font-weight: 900;
            color: var(--xmas-red);
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }
        .loot-desc {
            font-size: 0.9rem;
            color: #555;
            line-height: 1.4;
        }

        .jjk-tag {
            background: #2d2d2d;
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 0.5rem;
            font-family: 'Courier New', monospace;
        }

        /* --- FINAL MESSAGE & SUMMARY --- */
        .final-message-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
            width: 100%;
            padding-bottom: 50px; /* Space for scrolling */
        }

        .gift-summary {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid var(--xmas-gold);
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 2rem;
            width: 90%;
            max-width: 350px;
            text-align: left;
            opacity: 0;
            transform: translateY(20px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .gift-summary h3 {
            font-family: 'Fredoka', sans-serif;
            color: var(--xmas-gold);
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .summary-item {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            font-family: 'Kosugi Maru', sans-serif;
            margin-bottom: 0.8rem;
            font-size: 0.95rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 0.5rem;
        }
        .summary-item:last-child { border-bottom: none; }
        .summary-check { color: var(--xmas-green); font-size: 1.2rem; }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

    </style>
</head>
<body>

    <!-- VUE 1 : LA TIMELINE FINALE -->
    <div class="timeline-view" id="introView">
        <h1 class="header-title">25 D√âCEMBRE</h1>
        
        <div class="final-card" onclick="startShow()">
            <div class="card-badge">D√âBLOQU√â</div>
            <div class="text-6xl mb-4">üéÅ</div>
            <h2 class="font-bold text-2xl text-gray-800 mb-2">LE GRAND FINAL</h2>
            <p class="text-gray-500 mb-4 text-sm">Pr√™te pour ton cadeau ?</p>
            <div class="bg-red-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform active:scale-95 transition-transform inline-block">
                OUVRIR MAINTENANT
            </div>
        </div>
        
        <div class="absolute bottom-0 w-full flex justify-between px-4 opacity-50 pb-4">
            <span class="text-6xl">üéÑ</span>
            <span class="text-6xl">‚ú®</span>
            <span class="text-6xl">üéÑ</span>
        </div>
    </div>

    <!-- VUE 2 : SC√àNE DE NO√ãL -->
    <div class="christmas-scene" id="sceneView">
        <canvas id="snow-canvas"></canvas>

        <!-- Container pour le texte narratif -->
        <div id="story-container"></div>

        <!-- La Bo√Æte Cadeau -->
        <div class="gift-wrapper" id="giftBox" onclick="nextLoot()">
            <div class="gift-lid">
                <div class="gift-bow">üéÄ</div>
            </div>
            <div class="gift-box"></div>
            <div class="tap-hint">
                <span class="block text-xl mb-1">üëÜ</span>
                Clique plusieurs fois<br>pour tout d√©baller !
            </div>
        </div>

        <!-- Les Objets (G√©n√©r√©s par JS) -->
        <div id="loot-layer"></div>

        <!-- Message de fin -->
        <div class="final-message-container mt-10" id="finalMsg">
            <div class="text-6xl mb-4 animate-bounce">‚ù§Ô∏è</div>
            <div class="story-text" style="position: relative; top: auto; transform: none; opacity: 1; margin-bottom: 0.5rem;">Joyeux No√´l</div>
            <div class="text-4xl mt-2 font-fredoka text-white text-center">KANTO</div>
            <div class="text-sm mt-2 opacity-70 font-sans text-white">Ton plus grand fan.</div>

            <!-- SUMMARY LIST -->
            <div class="gift-summary" id="giftSummary">
                <h3>Ton Coffret Sp√©cial JJK</h3>
                <div id="summaryList"></div>
            </div>
        </div>
    </div>

    <script>
        // --- DONN√âES DU PACK JJK ---
        const gifts = [
            {
                emoji: "üì∏",
                title: "Bo√Æte de Carte Lomo",
                desc: "Tes persos imprim√©s avec amour.",
                tag: "M√âMOIRE VISUELLE"
            },
            {
                emoji: "‚úèÔ∏è",
                title: "Trousse JJK",
                desc: "Le kit parfait pour noter tes techniques maudites (ou juste tes cours).",
                tag: "ACCESSOIRE SCOLAIRE"
            },
            {
                emoji: "üìú",
                title: "Poster Collector",
                desc: "Une Extension de Territoire pour ton mur. Classe S garantie.",
                tag: "D√âCORATION"
            },
            {
                emoji: "‚ú®",
                title: "Stickers Pack",
                desc: "Pour coller ta personnalit√© partout. Sceaux de protection inclus.",
                tag: "CUSTOMISATION"
            },
            {
                emoji: "üß∏",
                title: "Figurine",
                desc: "Un petit compagnon pour veiller sur toi quand je ne suis pas l√†.",
                tag: "GARDE DU CORPS"
            },
            {
                emoji: "üéâ‚Äã",
                title: "Et plus encore",
                desc: "A toi de le decouvrir , je t'aime.",
                tag: "GARDE DU CORPS"
            }
        ];

        // --- HISTOIRE ---
        const storyLines = [
            "Kanto...",
            "Pour ce No√´l...",
            "Je voulais faire quelque chose d'unique.",
            "Comme toi.",
            "Voici ton tr√©sor..."
        ];

        // --- LOGIQUE ---
        const introView = document.getElementById('introView');
        const sceneView = document.getElementById('sceneView');
        const storyContainer = document.getElementById('story-container');
        const giftBox = document.getElementById('giftBox');
        const lootLayer = document.getElementById('loot-layer');
        const lid = document.querySelector('.gift-lid');
        const summaryList = document.getElementById('summaryList');
        
        let lootIndex = 0;
        let isAnimating = false;

        // 1. D√âMARRAGE
        function startShow() {
            gsap.to(introView, { y: -1000, opacity: 0, duration: 1.5, ease: "power2.in" });
            sceneView.classList.add('active');
            initSnow();
            animateSnow();
            playStorySequence();
        }

        // 2. S√âQUENCE HISTOIRE
        function playStorySequence() {
            const tl = gsap.timeline();
            
            storyLines.forEach((line, index) => {
                const el = document.createElement('div');
                el.classList.add('story-text');
                el.innerText = line;
                storyContainer.appendChild(el);

                tl.to(el, { opacity: 1, y: 0, duration: 1 });
                tl.to(el, { opacity: 0, y: -20, duration: 0.8, delay: 1.2 });
            });

            tl.to(giftBox, { 
                opacity: 1, 
                scale: 1, 
                duration: 1, 
                ease: "elastic.out(1, 0.5)",
                onComplete: () => {
                    gsap.to(giftBox, { y: -10, yoyo: true, repeat: -1, duration: 1.5, ease: "sine.inOut" });
                }
            });
        }

        // 3. OUVERTURE CADEAUX
        function nextLoot() {
            if (isAnimating) return;
            
            if (lootIndex >= gifts.length) {
                showFinalMessage();
                return;
            }

            isAnimating = true;
            const item = gifts[lootIndex];

            // Masquer le hint apr√®s le premier clic
            document.querySelector('.tap-hint').style.display = 'none';

            // Animation Bo√Æte
            const shakeTl = gsap.timeline();
            shakeTl.to(giftBox, { rotation: 5, duration: 0.1, yoyo: true, repeat: 5 });
            shakeTl.to(lid, { y: -60, rotation: -10, duration: 0.3 }, "-=0.2");

            // Cr√©er la carte Loot
            const card = document.createElement('div');
            card.classList.add('loot-item');
            card.innerHTML = `
                <div class="loot-image">
                    <div class="loot-bg-pattern"></div>
                    <span style="z-index:2">${item.emoji}</span>
                </div>
                <div class="loot-title">${item.title}</div>
                <p class="loot-desc">${item.desc}</p>
                <div class="jjk-tag">${item.tag}</div>
                <div style="margin-top:10px; font-size:0.8rem; color:#aaa">(Clique pour fermer)</div>
            `;
            lootLayer.appendChild(card);
            card.style.display = 'block';

            shakeTl.fromTo(card, 
                { scale: 0, y: 100, rotation: Math.random() * 20 - 10 },
                { scale: 1, y: 0, rotation: 0, duration: 0.8, ease: "back.out(1.7)" }
            );

            // Fermeture Loot
            card.onclick = () => {
                gsap.to(card, { 
                    scale: 0.5, opacity: 0, y: -200, duration: 0.5, 
                    onComplete: () => {
                        card.remove();
                        gsap.to(lid, { y: 0, rotation: 0, duration: 0.3 });
                        lootIndex++;
                        isAnimating = false;
                        
                        // Si c'√©tait le dernier
                        if(lootIndex >= gifts.length) {
                            setTimeout(showFinalMessage, 500);
                        }
                    }
                });
            };
        }

        // 4. MESSAGE FINAL & R√âSUM√â
        function showFinalMessage() {
            gsap.to(giftBox, { scale: 0, duration: 0.5 });
            
            // Populate Summary List
            summaryList.innerHTML = '';
            gifts.forEach(g => {
                summaryList.innerHTML += `
                    <div class="summary-item">
                        <span class="summary-check">‚úÖ</span>
                        <span>${g.emoji} ${g.title}</span>
                    </div>
                `;
            });
            // Ajout du "Et plus encore..."
            summaryList.innerHTML += `
                <div class="summary-item" style="opacity:0.8; font-style:italic; margin-top:10px;">
                    <span class="summary-check">‚ûï</span>
                    <span>Et plus encore...</span>
                </div>
            `;

            const finalMsg = document.getElementById('finalMsg');
            const summaryBox = document.getElementById('giftSummary');
            
            finalMsg.style.display = 'flex';
            
            // Animate Main Text
            gsap.fromTo(finalMsg, 
                { opacity: 0, y: 50 }, 
                { opacity: 1, y: 0, duration: 1.5, delay: 0.5 }
            );

            // Animate Summary Box
            gsap.to(summaryBox, {
                opacity: 1,
                y: 0,
                duration: 1,
                delay: 2, /* Appear after main text */
                ease: "power2.out"
            });
            
            createConfetti();
        }

        // --- ENGINE NEIGE ---
        const canvas = document.getElementById('snow-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let snowflakes = [];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        class Snowflake {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height - height;
                this.size = Math.random() * 3 + 1;
                this.speed = Math.random() * 2 + 1;
                this.opacity = Math.random() * 0.5 + 0.3;
                this.sway = Math.random() * 0.02; 
                this.angle = Math.random() * Math.PI * 2;
            }
            update() {
                this.y += this.speed;
                this.angle += this.sway;
                this.x += Math.sin(this.angle) * 0.5;

                if (this.y > height) {
                    this.y = -10;
                    this.x = Math.random() * width;
                }
            }
            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initSnow() {
            snowflakes = [];
            for (let i = 0; i < 100; i++) snowflakes.push(new Snowflake());
        }

        function animateSnow() {
            ctx.clearRect(0, 0, width, height);
            snowflakes.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateSnow);
        }

        window.addEventListener('resize', resize);
        resize();

        function createConfetti() {
            for(let i=0; i<50; i++) {
                const conf = document.createElement('div');
                conf.innerText = ['‚ú®', '‚ùÑÔ∏è', '‚ù§Ô∏è', 'üéÅ'][Math.floor(Math.random()*4)];
                conf.style.position = 'absolute';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.top = '-50px';
                conf.style.fontSize = (Math.random() * 20 + 10) + 'px';
                conf.style.transition = `top ${Math.random()*2+2}s linear, transform ${Math.random()*2+2}s linear`;
                sceneView.appendChild(conf);
                
                setTimeout(() => {
                    conf.style.top = '110vh';
                    conf.style.transform = `rotate(${Math.random()*360}deg)`;
                }, 100);
            }
        }

    </script>
</body>
</html>
